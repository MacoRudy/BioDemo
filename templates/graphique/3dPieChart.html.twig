{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} Graphs {% endblock %}

{% block Css %}
    <link rel="stylesheet" href="{{ asset('CSS/style.css') }}">
{% endblock %}

{% block body %}
    <div class="container-fluid">

        <div class="row text-center">
            <div class="col">
                <h1 class="mt-3">Commande par mois</h1>
                <div class="row">
                    <div class="col offset-2" id="piechart_3d" style="width: 700px; height: 600px;">
                    </div>
                </div>
                <a class="btn btn-primary btn-block" role="button" href="{{ path('graphique') }}">Retour</a>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
let annee = {{ annee }};

        $.ajax({
            url: '{{ path('commandes_3d_graphique') }}',
            type: 'POST',
            dataType: 'JSON',
            data: 'annee=' + annee,
            async: true,
            error: function (xhr, textStatus, errorThrown) {
                alert('Ajax request failed.');
            }
        })
            .done(function (response) {

                google.charts.load("current", {packages: ["corechart"]});
                google.charts.setOnLoadCallback(drawChart);

                function drawChart() {
                    let data = google.visualization.arrayToDataTable(response);

                    let options = {
                        title: "Commande de l'ann√©e "+annee,
                        is3D: true,
                    };

                    let chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
                    chart.draw(data, options);
                }
            })
    </script>
{% endblock %}